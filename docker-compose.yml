version: "3.8"

services:
  plusins-api:
    build:
      context: ./plusins_api
      args:
        PROJECT: plusins
    container_name: plusins-api
    ports:
      - "8081:8081"
      - "9010:8081"   # ✅ 同時支援 8081 與 9010
    restart: always
    environment:
      TZ: Asia/Manila
      GOMODCACHE: /go/pkg/mod         # ✅ Go module 快取
    depends_on:
      - plusins-rpc
    volumes:
      - /home/a/gg-pr-plusins/plusins_api/etc:/app/etc
      - /home/a/simple-admin-core/resource/i18n:/app/resource/i18n
      - /home/a/.cache/go-mod:/go/pkg/mod   # ✅ 模組快取持久化
    networks:
      - plusins-net

  plusins-business:
    build:
      context: ./plusins_business
      args:
        PROJECT: plusins
    container_name: plusins-business
    ports:
      - "8082:8082"        # ✅ Business API 主埠
      - "9012:8082"        # ✅ 額外對外訪問用（可選）
    restart: always
    environment:
      TZ: Asia/Manila
      GOMODCACHE: /go/pkg/mod
    depends_on:
      - plusins-rpc
      - redis
      - postgresql
    volumes:
      - /home/a/gg-pr-plusins/plusins_business/etc:/app/etc
      - /home/a/simple-admin-core/resource/i18n:/app/resource/i18n
      - /home/a/.cache/go-mod:/go/pkg/mod
      - /home/data/logs/plusins_business:/home/data/logs/plusins_business
    networks:
      - plusins-net

  plusins-rpc:
    build:
      context: ./plusins_rpc
      args:
        PROJECT: plusins
    container_name: plusins-rpc
    restart: always
    environment:
      TZ: Asia/Manila
      GOMODCACHE: /go/pkg/mod
    volumes:
      - /home/a/gg-pr-plusins/plusins_rpc/etc:/app/etc
      - /home/a/.cache/go-mod:/go/pkg/mod   # ✅ 模組快取持久化
    networks:
      - plusins-net

networks:
  plusins-net:
    driver: bridge
